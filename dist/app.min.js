/*! TestDahman 16-03-2015 */
!function(a,b,c){"use strict";c.module("googlechart",[]).value("googleChartApiConfig",{version:"1",optionalSettings:{packages:["corechart"]}}).provider("googleJsapiUrl",function(){var a="https:",b="//www.google.com/jsapi";this.setProtocol=function(b){a=b},this.setUrl=function(a){b=a},this.$get=function(){return(a?a:"")+b}}).factory("googleChartApiPromise",["$rootScope","$q","googleChartApiConfig","googleJsapiUrl",function(d,e,f,g){var h=e.defer(),i=function(){var a={callback:function(){var a=f.optionalSettings.callback;d.$apply(function(){h.resolve()}),c.isFunction(a)&&a.call(this)}};a=c.extend({},f.optionalSettings,a),b.google.load("visualization",f.version,a)},j=a.getElementsByTagName("head")[0],k=a.createElement("script");return k.setAttribute("type","text/javascript"),k.src=g,k.addEventListener?k.addEventListener("load",i,!1):k.onreadystatechange=function(){("loaded"===k.readyState||"complete"===k.readyState)&&(k.onreadystatechange=null,i())},j.appendChild(k),h.promise}]).directive("googleChart",["$timeout","$window","$rootScope","googleChartApiPromise",function(a,b,d,e){return{restrict:"A",scope:{beforeDraw:"&",chart:"=chart",onReady:"&",onSelect:"&",select:"&",group:"@"},link:function(b,f,g){function h(a,d,e){if("undefined"!=typeof b.chart.formatters[a]){if(!c.equals(b.chart.formatters[a],b.oldChartFormatters[a]))if(b.oldChartFormatters[a]=b.chart.formatters[a],b.formatters[a]=[],"color"===a)for(var f=0;f<b.chart.formatters[a].length;f++){var g=new d;for(i=0;i<b.chart.formatters[a][f].formats.length;i++){var h=b.chart.formatters[a][f].formats[i];"undefined"!=typeof h.fromBgColor&&"undefined"!=typeof h.toBgColor?g.addGradientRange(h.from,h.to,h.color,h.fromBgColor,h.toBgColor):g.addRange(h.from,h.to,h.color,h.bgcolor)}b.formatters[a].push(g)}else for(var i=0;i<b.chart.formatters[a].length;i++)b.formatters[a].push(new d(b.chart.formatters[a][i]));for(i=0;i<b.formatters[a].length;i++)b.chart.formatters[a][i].columnNum<e.getNumberOfColumns()&&b.formatters[a][i].format(e,b.chart.formatters[a][i].columnNum);("arrow"===a||"bar"===a||"color"===a)&&(b.chart.options.allowHtml=!0)}}function i(){i.triggered||void 0==b.chart||(i.triggered=!0,a(function(){if("undefined"==typeof b.chartWrapper){var c={chartType:b.chart.type,dataTable:b.chart.data[b.group],view:b.chart.view,options:b.chart.options,containerId:f[0]};b.chartWrapper=new google.visualization.ChartWrapper(c),google.visualization.events.addListener(b.chartWrapper,"ready",function(){b.chart.displayed=!0,b.$apply(function(a){a.onReady({chartWrapper:a.chartWrapper})})}),google.visualization.events.addListener(b.chartWrapper,"error",function(a){console.log("Chart not displayed due to error: "+a.message+". Full error object follows."),console.log(a)}),google.visualization.events.addListener(b.chartWrapper,"select",function(){var a=b.chartWrapper.getChart().getSelection()[0];b.$apply(function(){g.select?(console.log("Angular-Google-Chart: The 'select' attribute is deprecated and will be removed in a future release.  Please use 'onSelect'."),b.select({selectedItem:a})):b.onSelect({selectedItem:a})})})}else b.chartWrapper.setChartType(b.chart.type),b.chartWrapper.setDataTable(b.chart.data[b.group]),b.chartWrapper.setView(b.chart.view),b.chartWrapper.setOptions(b.chart.options);"undefined"==typeof b.formatters&&(b.formatters={}),"undefined"!=typeof b.chart.formatters&&(h("number",google.visualization.NumberFormat,b.chartWrapper.getDataTable()),h("arrow",google.visualization.ArrowFormat,b.chartWrapper.getDataTable()),h("date",google.visualization.DateFormat,b.chartWrapper.getDataTable()),h("bar",google.visualization.BarFormat,b.chartWrapper.getDataTable()),h("color",google.visualization.ColorFormat,b.chartWrapper.getDataTable()));var d=b.chart.customFormatters;if("undefined"!=typeof d)for(var e in d)h(e,d[e],b.chartWrapper.getDataTable());a(function(){b.beforeDraw({chartWrapper:b.chartWrapper}),b.chartWrapper.draw(),i.triggered=!1})},0,!0))}function j(){e.then(function(){i()})}b.$watch(function(){return b.chart?{customFormatters:b.chart.customFormatters,data:b.chart.data[b.group],formatters:b.chart.formatters,options:b.chart.options,type:b.chart.type,view:b.chart.view}:b.chart},function(){j()},!0);var k=d.$on("resizeMsg",function(){a(function(){b.chartWrapper&&j()})});b.$on("$destroy",function(){k()}),b.oldChartFormatters={}}}}]).run(["$rootScope","$window",function(a,b){c.element(b).bind("resize",function(){a.$emit("resizeMsg")})}])}(document,window,window.angular);var worldcup=angular.module("worldcup",["ngRoute","googlechart"]);worldcup.config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/home.html",controller:"AppCtrl"}).when("/team/:iso",{templateUrl:"views/team.html",controller:"teamCtrl"}).when("/all_team/",{templateUrl:"views/all_team.html",controller:"allteamCtrl"}).otherwise({redirectTo:"/",controller:"AppCtrl"})}]).value("googleChartApiConfig",{version:"1",optionalSettings:{packages:["corechart"],language:"fr"}}),worldcup.controller("AppCtrl",["$scope","wcService","$routeParams",function(a,b){a.chartObject={data:{}},a.chartObject.type="PieChart",a.groups=[],b.getListgroup().then(function(b){b.data.forEach(function(b){group={id:b.group.id,letter:b.group.letter,teams:b.group.teams},a.groups.push(group),slices={cols:[{id:"t",label:"Topping",type:"string"},{id:"s",label:"Slices",type:"number"}],rows:[]},angular.forEach(b.group.teams,function(a){slice={c:[{v:a.team.country},{v:a.team.points}]},slices.rows.push(slice)}),a.chartObject.data[b.group.letter]=slices})})}]),worldcup.controller("teamCtrl",["$scope","wcService","$routeParams",function(a,b,c){a.matchs=[],b.getDetailTeam(c.iso).then(function(b){b.data.forEach(function(b){match={location:b.location,home_team:b.home_team,away_team:b.away_team,winner:b.winner,eventHome:[],eventaway:[]},b.home_team_events.length>0&&angular.forEach(b.home_team_events,function(a){match.eventHome.push(a)}),b.away_team_events.length>0&&angular.forEach(b.away_team_events,function(a){match.eventaway.push(a)}),a.matchs.push(match)})})}]),worldcup.controller("allteamCtrl",["$scope","wcService",function(a,b){a.teams=[],b.getlistTeam().then(function(b){b.data.forEach(function(b){team={country:b.country,fifa_code:b.fifa_code,group_id:b.group_id},a.teams.push(team)})})}]),worldcup.service("wcService",["$http","$rootScope","$q",function(a,b,c){c.defer();this.getListgroup=function(){return a.get("http://worldcup.sfg.io/teams/group_results").success(function(a){return a})},this.getDetailTeam=function(b){return a.get("http://worldcup.sfg.io/matches/country?fifa_code="+b.toUpperCase()).success(function(a){return a})},this.getlistTeam=function(){return a.get("http://worldcup.sfg.io/teams/").success(function(a){return a})}}]);